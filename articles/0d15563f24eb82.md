---
title: "Godot Mod Loaderã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ä½¿ã„æ–¹"
emoji: "ğŸ¡"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["godot", "mod", "modding"]
published: true
---

## ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹ã¯[Godot Modding å…¥é–€](https://zenn.dev/rinjugatla/articles/92907e2c033c2f)ã«é–¢é€£ã—ã¦MODã®è¨­å®šã‚’æ›¸å‡ºã—ã€ãƒªãƒªãƒ¼ã‚¹å¾Œã«ãƒ¦ãƒ¼ã‚¶ãŒè¨­å®šã‚’å¤‰æ›´ã§ãã‚‹ä»•çµ„ã¿ã¥ãã‚Šã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚

## æˆæœç‰©

ã“ã®è§£èª¬ã‚’é€šã—ã¦è§£èª¬ã™ã‚‹å†…å®¹ã«é–¢é€£ã™ã‚‹æˆæœç‰©ã‚’å…ˆã«ç¤ºã—ã¾ã™ã€‚

- è¨­å®šèª­ã¿è¾¼ã¿æ©Ÿèƒ½ã‚’åˆ©ç”¨ã—ãŸä¾‹

[Tiny Pasture åŒå­ä¸‰ã¤å­MOD](https://github.com/rinjugatla/TinyPasture-multi_baby)ã‚’ä½œæˆã—ã¾ã—ãŸã€‚
å‹•ç‰©ã‚’äº¤é…ã—ãŸéš›ã«å›ºå®šã§1åŒ¹æ–°ã—ã„å‹•ç‰©ãŒç”£ã¾ã‚Œã‚‹ä»•çµ„ã¿ã«ã¤ã„ã¦ã€ç¢ºç‡ã§2åŒ¹ã‚„3åŒ¹ç”£ã¾ã‚Œã‚‹ä»•çµ„ã¿ã‚’è¿½åŠ ã™ã‚‹ã¨ã„ã†ã‚‚ã®ã§ã™ã€‚

äº¤é…ã—ãŸéš›ã«ä½•åŒ¹ç”Ÿã¾ã‚Œã‚‹ã®ã‹ã®ç¢ºç‡ã‚’ãƒ¦ãƒ¼ã‚¶ãŒå¤‰æ›´ã§ãã‚‹ä»•çµ„ã¿ã‚’å°å…¥ã—ã¦ã„ã¾ã™ã€‚

- Godot Mod Loaderã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹è¨­å®šå‘¨ã‚Šã®æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ãŸä¾‹

`Tiny Pasture åŒå­ä¸‰ã¤å­MOD`ã§ã¯åˆ©ç”¨ã—ãªã‹ã£ãŸMod Loaderã«ç”¨æ„ã•ã‚Œã¦ã„ã‚‹æ©Ÿèƒ½ã‚’åˆ©ç”¨ã—ãŸä¾‹ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

[GodotMod-config_sample](https://github.com/rinjugatla/GodotMod-config_sample)

## è¨­å®šæ©Ÿèƒ½ã®ä½¿ã„æ–¹

### MODåŸºæœ¬æƒ…å ±ã®æ§‹æˆ

MODã®åŸºæœ¬æƒ…å ±ã§ã‚ã‚‹åå‰ã‚„èª¬æ˜ã¯`manifest.json`ã«æ›¸ãè¾¼ã¿ã¾ã™ã€‚
MODã®è¨­å®šã¯`extra.godot.config_schema`ã«å®šç¾©ã—ã¾ã™ã€‚

```json:manifest.json
{
    "dependencies": [],
    "description": "Provides the ability to occasionally have twins or triplets",
    "extra": {
        "godot": {
            "authors": ["rin_jugatla"],
            "compatible_game_version": ["1.0.10"],
            "compatible_mod_loader_version": ["7.0.1"],
            "config_schema": {
                // ã“ã“ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’æ›¸ãè¾¼ã‚€
            },
            "description_rich": "",
            "image": null,
            "incompatibilities": [],
            "load_before": [],
            "optional_dependencies": [],
            "tags": []
        }
    },
    "name": "multi_baby",
    "namespace": "rin_jugatla",
    "version_number": "0.0.2",
    "website_url": "https://github.com/rinjugatla/TinyPasture-multi_baby"
}
```

### å®šç¾©æ–¹æ³•

MODã®åŸºæœ¬æƒ…å ±ã‚’æ›¸ãè¾¼ã‚€`manifest.json`ã«è¨­å®šã‚’æ›¸ãè¾¼ã¿ã¾ã™ã€‚
MODè¨­å®šã‚’å®šç¾©ã€ç·¨é›†ã™ã‚‹GUIã¯ã¾ã ä¸€èˆ¬å…¬é–‹ã•ã‚Œã¦ã„ãªã„ã®ã§jsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ‰‹å‹•ã§ç·¨é›†ã—ã¾ã™ã€‚

`manifest.json`ã«ã¯MODåã‚„ä¾å­˜é–¢ä¿‚ãªã©æ§˜ã€…ãªæƒ…å ±ãŒæ›¸ãè¾¼ã¾ã‚Œã¾ã™ãŒã€ä»Šå›ã¯è¨­å®šã«é–¢é€£ã™ã‚‹é …ç›®ã®ã¿ã‚’æŠœãå‡ºã—ã¦è¡¨è¨˜ã—ã¾ã™ã€‚
ãƒ‡ãƒ¼ã‚¿å‹ã‚„ä»–ã®å®šç¾©ä¾‹ã«ã¤ã„ã¦ã¯[å…¬å¼ã‚µã‚¤ãƒˆ](https://wiki.godotmodding.com/guides/modding/creating_mod_config_schema/)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

```json:manifest.json
{
    "extra": {
        "godot": {
            "config_schema": {
                // ã“ã“ã‹ã‚‰
                "title": "Config", // ãƒ†ã‚­ã‚¹ãƒˆã¯è‡ªç”±è¨˜è¿°
                "description": "Config for this Mod", // ãƒ†ã‚­ã‚¹ãƒˆã¯è‡ªç”±è¨˜è¿°
                "type": "object", // objectå›ºå®š
                "properties": { // è¨­å®šã®å®šç¾©
                    "create_baby_probability": { // è¨­å®šã‚­ãƒ¼
                        "title": "create_baby_probability", // è¨­å®šå
                        "type": "object", // ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ—
                        "default": { // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
                            "single": 85,
                            "double": 10,
                            "triple": 5
                        }
                    }
                }
                // ã“ã“ã¾ã§
            },
        }
    },
}
```

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜å…ˆ

`è¨­å®š`ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯å¿…ãš`ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š`ãŒå¿…è¦ã§ã™ã€‚
ã‚²ãƒ¼ãƒ ãŒèµ·å‹•ã—MODãŒèª­ã¿è¾¼ã¾ã‚ŒãŸéš›ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’ã¾ã¨ã‚ãŸ`default.json`ãŒã‚»ãƒ¼ãƒ–ãƒ•ã‚©ãƒ«ãƒ€ã«æ›¸ãå‡ºã•ã‚Œã¾ã™ã€‚

- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹

ã‚»ãƒ¼ãƒ–ãƒ•ã‚©ãƒ«ãƒ€ã¯ã‚²ãƒ¼ãƒ ã«é•ã†å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ãŒ`Tiny Pasture`ã§ã¯ä»¥ä¸‹ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚

```text
# æ›¸å¼
C:\Users\%username%\AppData\Roaming\[ã‚²ãƒ¼ãƒ å]\mod_configs\[MODãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹-MODå]\default.json
# ä¾‹
C:\Users\%username%\AppData\Roaming\TinyPasture\mod_configs\rin_jugatla-multi_baby\default.json
```

### ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä¾‹

`manifest.json`ã«ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã—ãŸå ´åˆã®`default.json`ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

```json:manifest.json
{
    "config_schema": {
        "title": "Config",
        "description": "Config for this Mod",
        "type": "object",
        "properties": {
            "create_baby_probability": {
                "title": "create_baby_probability",
                "type": "object",
                "default": {
                    "single": 85,
                    "double": 10,
                    "triple": 5
                }
            }
        }
    }
}
```

`default.json`ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å‡ºåŠ›ã•ã‚Œã¾ã™ã€‚

`manifest.json`ã«è¡¨è¨˜ã™ã‚‹`config_schema.title`ãªã©ã¯è¡¨ç¾ã•ã‚Œã¾ã›ã‚“ã€‚
`config_schema.title`ãªã©ã¯MODåˆ¶ä½œè€…ãŒè¨­å®šã®å†…å®¹ã‚„æ³¨ã‚’æ®‹ã™ãŸã‚ã«ä½¿ç”¨ã™ã‚‹é …ç›®ã§ã‚ã‚Šã€å¿…é ˆã®é …ç›®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
ãŸã ä¿å®ˆã‚‚è€ƒãˆã¦æœ€ä½é™å®šç¾©ã—ã¦ãŠã„ãŸæ–¹ãŒå®‰å…¨ã§ã™ã€‚

```json:default.json
{
    "create_baby_probability": {
        "double": 10,
        "single": 85,
        "triple": 5
    }
}
```

### è¨­å®šã®èª­ã¿è¾¼ã¿

ä»»æ„ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚

```gdscript:manager.gd
# ãƒ¦ãƒ¼ã‚¶å®šç¾©ã®è¨­å®šãŒãªã„å ´åˆã«ä½¿ç”¨ã™ã‚‹è¨­å®š
var create_baby_probability = {
    "single" = 85,
    "double" = 10,
    "triple" = 5
}
    
# Called when the node enters the scene tree for the first time.
func _init() -> void:
    _load_config()

func _load_config() -> void:
    # ãƒ¦ãƒ¼ã‚¶å®šç¾©ã®è¨­å®šã‚’ãƒ­ãƒ¼ãƒ‰
    # C:\Users\%username%\AppData\Roaming\TinyPasture\mod_configs\rin_jugatla-config_sample\custom.json
    const MOD_ID = "rin_jugatla-config_sample"
    const USER_CONFIG_NAME = "custom"
    
    # ãƒ¦ãƒ¼ã‚¶å®šç¾©ã®ã‚³ãƒ³ãƒ•ã‚£ã‚°ãŒå­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
    var has_config = ModLoaderConfig.has_config(MOD_ID, USER_CONFIG_NAME)
    if has_config:
        # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿
        var custom = ModLoaderConfig.get_config(MOD_ID, USER_CONFIG_NAME)
        const PROPERTY_NAME = "create_baby_probability"
        var probability = custom.data.get(PROPERTY_NAME)
        var required_fields: = ["single", "double", "triple"]
        var is_valid = probability.has_all(required_fields)
        if is_valid:
            create_baby_probability = probability
```

## å‚è€ƒè³‡æ–™

- [Godot Mod Loader](https://wiki.godotmodding.com/)
  - [Manifest.jsonã®æ›¸å¼](https://wiki.godotmodding.com/guides/modding/config_json/)
  - [Modã®è¨­å®š](https://wiki.godotmodding.com/guides/modding/creating_mod_config_schema/)
